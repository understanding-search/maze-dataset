<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.1"/>
    <title>maze_dataset.tokenization.modular.element_base API documentation</title>
<link rel="stylesheet" href="../../../resources/css/bootstrap-reboot.min.css"><link rel="stylesheet" href="../../../resources/css/syntax-highlighting.css"><link rel="stylesheet" href="../../../resources/css/theme.css"><link rel="stylesheet" href="../../../resources/css/layout.css"><link rel="stylesheet" href="../../../resources/css/content.css"><link rel="stylesheet" href="../../../resources/css/custom.css"><script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']]
        }
    };
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
    /* Re-invoke MathJax when DOM content changes, for example during search. */
    document.addEventListener("DOMContentLoaded", () => {
        new MutationObserver(() => MathJax.typeset()).observe(
            document.querySelector("main.pdoc").parentNode,
            {childList: true}
        );
    })
</script>
<style>
    mjx-container {
        overflow-x: auto;
        overflow-y: hidden;
    }
</style><style>
    .pdoc .mermaid-pre {
        border: none;
        background: none;
    }
</style>
<script type="module" defer>
    import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs";

    /* Re-invoke Mermaid when DOM content changes, for example during search. */
    document.addEventListener("DOMContentLoaded", () => {
        new MutationObserver(() => mermaid.run()).observe(
            document.querySelector("main.pdoc").parentNode,
            {childList: true}
        );
    })
</script></head>
<body>
<div class="package-version">
    docs for <a href="https://github.com/understanding-search/maze-dataset">maze-dataset</a> v1.3.0<br>
</div>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button">
            <img src="../../../resources/svg/navtoggle.svg" alt="Toggle navigation"> 
        </label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../modular.html">
                <img src="../../../resources/svg/box-arrow-in-left.svg" alt="Back to parent module"/>
                &nbsp;maze_dataset.tokenization.modular</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="function" href="#mark_as_unsupported">mark_as_unsupported</a>
            </li>
    </ul>


    <hr/>
    
    <div>
        <a href="../../../coverage/html/index.html" class="pdoc-button" title="View test coverage report">
            Coverage
        </a>
        <a href="../../../other/todo-inline.html" class="pdoc-button" title="Table of TODOs scraped from source code, with links to create issues from them">
            TODOs
        </a>
        <a href="../../../other/lmcat.txt" class="pdoc-button" title="a view of the repo contents made for LLMs, using https://miv.name/lmcat">
            lmcat
        </a>
    </div>


        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span>
            <img src="../../../resources/svg/pdoc-logo.svg" alt="pdoc logo"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                        <a class="pdoc-button git-button" href="https://github.com/understanding-search/maze-dataset/blob/1.3.0maze_dataset/tokenization/modular/element_base.py">View Source on GitHub</a>
                    <h1 class="modulename">
<a href="./../../../maze_dataset.html">maze_dataset</a><wbr>.<a href="./../../tokenization.html">tokenization</a><wbr>.<a href="./../modular.html">modular</a><wbr>.element_base    </h1>

                        <div class="docstring"><p>provides the base <code>_TokenizerElement</code> class and related functionality for modular maze tokenization</p>

<p>see the code in <code><a href="elements.html">maze_dataset.tokenization.modular.elements</a></code> for examples of subclasses of <code>_TokenizerElement</code></p>
</div>

                        <input id="mod-element_base-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <div class="source-button-container">
            <label class="pdoc-button view-source-button" for="mod-element_base-view-source"><span>View Source</span></label>
            <div class="github-button-wrapper">
                <a class="pdoc-button github-link-button" href="https://github.com/understanding-search/maze-dataset/blob/1.3.0maze_dataset/tokenization/modular/element_base.py#L0-L313" target="_blank">
                    <span>View on GitHub</span>
                </a>
            </div>
        </div>

                <br/>
                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="sd">&quot;&quot;&quot;provides the base `_TokenizerElement` class and related functionality for modular maze tokenization</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="sd">see the code in `maze_dataset.tokenization.modular.elements` for examples of subclasses of `_TokenizerElement`</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">abc</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a>	<span class="n">Any</span><span class="p">,</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a>	<span class="n">Callable</span><span class="p">,</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a>	<span class="n">Literal</span><span class="p">,</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a>	<span class="n">TypeVar</span><span class="p">,</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="p">)</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">muutils.json_serialize</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a>	<span class="n">SerializableDataclass</span><span class="p">,</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a>	<span class="n">serializable_dataclass</span><span class="p">,</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a>	<span class="n">serializable_field</span><span class="p">,</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="p">)</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">muutils.json_serialize.util</span><span class="w"> </span><span class="kn">import</span> <span class="n">_FORMAT_KEY</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">muutils.misc</span><span class="w"> </span><span class="kn">import</span> <span class="n">flatten</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">zanj.loading</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_item_recursive</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">maze_dataset.tokenization.modular.hashing</span><span class="w"> </span><span class="kn">import</span> <span class="n">_hash_tokenizer_name</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="c1"># from maze_dataset import SolvedMaze</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="nd">@serializable_dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">kw_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="k">class</span><span class="w"> </span><span class="nc">_TokenizerElement</span><span class="p">(</span><span class="n">SerializableDataclass</span><span class="p">,</span> <span class="n">abc</span><span class="o">.</span><span class="n">ABC</span><span class="p">):</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;Superclass for tokenizer elements.</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">	Subclasses contain modular functionality for maze tokenization.</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">	# Development</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">	&gt; [!TIP]</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">	&gt; Due to the functionality of `get_all_tokenizers()`, `_TokenizerElement` subclasses</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">	&gt; may only contain fields of type `utils.FiniteValued`.</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">	&gt; Implementing a subclass with an `int` or `float`-typed field, for example, is not supported.</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">	&gt; In the event that adding such fields is deemed necessary, `get_all_tokenizers()` must be updated.</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>	<span class="c1"># TYPING: type hint `v` more specifically</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>	<span class="nd">@staticmethod</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">_stringify</span><span class="p">(</span><span class="n">k</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>  <span class="c1"># noqa: ANN401</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>			<span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">_TokenizerElement</span><span class="p">):</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>			<span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="n">name</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>			<span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;(&#39;</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;, &#39;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">v</span><span class="p">],</span><span class="w"> </span><span class="s1">&#39;)&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>			<span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>	<span class="nd">@property</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>		<span class="n">members_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>			<span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_stringify</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;_type_&quot;</span><span class="p">],</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>		<span class="p">)</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>		<span class="n">output</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">members_str</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>		<span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">output</span> <span class="ow">and</span> <span class="n">output</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">output</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>			<span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>			<span class="k">return</span> <span class="n">output</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>	<span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>	<span class="c1"># TYPING: type hints for `__init_subclass__`?</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">__init_subclass__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  <span class="c1"># noqa: ANN204</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;Hack: dataclass hashes don&#39;t include the class itself in the hash function inputs.</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="sd">		This causes dataclasses with identical fields but different types to hash identically.</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="sd">		This hack circumvents this by adding a slightly hidden field to every subclass with a value of `repr(cls)`.</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="sd">		To maintain compatibility with `all_instances`, the static type of the new field can only have 1 possible value.</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">		So we type it as a singleton `Literal` type.</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">		muutils 0.6.1 doesn&#39;t support `Literal` type validation, so `assert_type=False`.</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="sd">		Ignore Pylance complaining about the arg to `Literal` being an expression.</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>		<span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init_subclass__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>		<span class="c1"># we are adding a new attr here intentionally</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>		<span class="bp">cls</span><span class="o">.</span><span class="n">_type_</span> <span class="o">=</span> <span class="n">serializable_field</span><span class="p">(</span>  <span class="c1"># type: ignore[attr-defined]</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>			<span class="n">init</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>			<span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>			<span class="n">default</span><span class="o">=</span><span class="nb">repr</span><span class="p">(</span><span class="bp">cls</span><span class="p">),</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>			<span class="n">assert_type</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>		<span class="p">)</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>		<span class="bp">cls</span><span class="o">.</span><span class="vm">__annotations__</span><span class="p">[</span><span class="s2">&quot;_type_&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="nb">repr</span><span class="p">(</span><span class="bp">cls</span><span class="p">)]</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>	<span class="k">def</span><span class="w"> </span><span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>		<span class="s2">&quot;Stable hash to identify unique `MazeTokenizerModular` instances. uses name&quot;</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>		<span class="k">return</span> <span class="n">_hash_tokenizer_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>	<span class="nd">@classmethod</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">_level_one_subclass</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">type</span><span class="p">[</span><span class="s2">&quot;_TokenizerElement&quot;</span><span class="p">]:</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;Returns the immediate subclass of `_TokenizerElement` of which `cls` is an instance.&quot;&quot;&quot;</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>		<span class="k">return</span> <span class="p">(</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>			<span class="nb">set</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__mro__</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">_TokenizerElement</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()))</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>		<span class="p">)</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">tokenizer_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="s2">&quot;_TokenizerElement&quot;</span><span class="p">]:</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;Returns a list of all `_TokenizerElement` instances contained in the subtree.</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a><span class="sd">		Currently only detects `_TokenizerElement` instances which are either direct attributes of another instance or</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a><span class="sd">		which sit inside a `tuple` without further nesting.</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="sd">		# Parameters</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a><span class="sd">		- `deep: bool`: Whether to return elements nested arbitrarily deeply or just a single layer.</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>		<span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="o">==</span> <span class="nb">tuple</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>  <span class="c1"># noqa: E721</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>			<span class="k">return</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>				<span class="n">flatten</span><span class="p">(</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>					<span class="p">[</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>						<span class="p">[</span><span class="n">el</span><span class="p">,</span> <span class="o">*</span><span class="n">el</span><span class="o">.</span><span class="n">tokenizer_elements</span><span class="p">()]</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>						<span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>						<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="n">_TokenizerElement</span><span class="p">)</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>					<span class="p">],</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>				<span class="p">)</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>				<span class="k">if</span> <span class="n">deep</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>				<span class="k">else</span> <span class="nb">filter</span><span class="p">(</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>					<span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">_TokenizerElement</span><span class="p">),</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>					<span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>				<span class="p">),</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>			<span class="p">)</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>			<span class="n">non_tuple_elems</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">_TokenizerElement</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>				<span class="n">flatten</span><span class="p">(</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>					<span class="p">[</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>						<span class="p">[</span><span class="n">el</span><span class="p">,</span> <span class="o">*</span><span class="n">el</span><span class="o">.</span><span class="n">tokenizer_elements</span><span class="p">()]</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>						<span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>						<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="n">_TokenizerElement</span><span class="p">)</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>					<span class="p">]</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>					<span class="k">if</span> <span class="n">deep</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>					<span class="k">else</span> <span class="nb">filter</span><span class="p">(</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>						<span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">_TokenizerElement</span><span class="p">),</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>						<span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>					<span class="p">),</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>				<span class="p">),</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>			<span class="p">)</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>			<span class="n">tuple_elems</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">_TokenizerElement</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>				<span class="n">flatten</span><span class="p">(</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>					<span class="p">[</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>						<span class="p">(</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>							<span class="p">[</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>								<span class="p">[</span><span class="n">tup_el</span><span class="p">,</span> <span class="o">*</span><span class="n">tup_el</span><span class="o">.</span><span class="n">tokenizer_elements</span><span class="p">()]</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>								<span class="k">for</span> <span class="n">tup_el</span> <span class="ow">in</span> <span class="n">el</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>								<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tup_el</span><span class="p">,</span> <span class="n">_TokenizerElement</span><span class="p">)</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>							<span class="p">]</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>							<span class="k">if</span> <span class="n">deep</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>							<span class="k">else</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">_TokenizerElement</span><span class="p">),</span> <span class="n">el</span><span class="p">)</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>						<span class="p">)</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>						<span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>						<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>					<span class="p">],</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>				<span class="p">),</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>			<span class="p">)</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>			<span class="n">non_tuple_elems</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">tuple_elems</span><span class="p">)</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>			<span class="k">return</span> <span class="n">non_tuple_elems</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">tokenizer_element_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">abstract</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;Returns a string representation of the tree of tokenizer elements contained in `self`.</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a><span class="sd">		# Parameters</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a><span class="sd">		- `depth: int`: Current depth in the tree. Used internally for recursion, no need to specify.</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a><span class="sd">		- `abstract: bool`: Whether to print the name of the abstract base class or the concrete class for each `_TokenizerElement` instance.</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>		<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">*</span> <span class="n">depth</span> <span class="o">+</span> <span class="p">(</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>			<span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>			<span class="k">if</span> <span class="ow">not</span> <span class="n">abstract</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>			<span class="k">else</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_level_one_subclass</span><span class="p">()</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>		<span class="p">)</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>		<span class="k">return</span> <span class="p">(</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>			<span class="n">name</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>			<span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>			<span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>				<span class="n">el</span><span class="o">.</span><span class="n">tokenizer_element_tree</span><span class="p">(</span><span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">abstract</span><span class="p">)</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>				<span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer_elements</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>			<span class="p">)</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>		<span class="p">)</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">tokenizer_element_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;Returns a dictionary representation of the tree of tokenizer elements contained in `self`.&quot;&quot;&quot;</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>		<span class="k">return</span> <span class="p">{</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>			<span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>				<span class="n">key</span><span class="p">:</span> <span class="p">(</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>					<span class="n">val</span><span class="o">.</span><span class="n">tokenizer_element_dict</span><span class="p">()</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>					<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">_TokenizerElement</span><span class="p">)</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>					<span class="k">else</span> <span class="p">(</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>						<span class="n">val</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>						<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>						<span class="k">else</span> <span class="p">[</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>							<span class="p">(</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>								<span class="n">el</span><span class="o">.</span><span class="n">tokenizer_element_dict</span><span class="p">()</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>								<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="n">_TokenizerElement</span><span class="p">)</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>								<span class="k">else</span> <span class="n">el</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>							<span class="p">)</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>							<span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">val</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>						<span class="p">]</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>					<span class="p">)</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>				<span class="p">)</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>				<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>				<span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s2">&quot;_type_&quot;</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>			<span class="p">},</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>		<span class="p">}</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>	<span class="nd">@classmethod</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>	<span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">attribute_key</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;Returns the binding used in `MazeTokenizerModular` for that type of `_TokenizerElement`.&quot;&quot;&quot;</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>		<span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">to_tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;Converts a maze element into a list of tokens.</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a><span class="sd">		Not all `_TokenizerElement` subclasses produce tokens, so this is not an abstract method.</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a><span class="sd">		Those subclasses which do produce tokens should override this method.</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>		<span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>	<span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">is_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">do_except</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;Returns if `self` contains data members capable of producing an overall valid `MazeTokenizerModular`.</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a><span class="sd">		Some `_TokenizerElement` instances may be created which are not useful despite obeying data member type hints.</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a><span class="sd">		`is_valid` allows for more precise detection of invalid `_TokenizerElement`s beyond type hinting alone.</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a><span class="sd">		If type hints are sufficient to constrain the possible instances of some subclass, then this method may simply `return True` for that subclass.</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a><span class="sd">		# Types of Invalidity</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a><span class="sd">		In nontrivial implementations of this method, each conditional clause should contain a comment classifying the reason for invalidity and one of the types below.</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a><span class="sd">		Invalidity types, in ascending order of invalidity:</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a><span class="sd">		- Uninteresting: These tokenizers might be used to train functional models, but the schemes are not interesting to study.</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a><span class="sd">		E.g., `_TokenizerElement`s which are strictly worse than some alternative.</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a><span class="sd">		- Duplicate: These tokenizers have identical tokenization behavior as some other valid tokenizers.</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a><span class="sd">		- Untrainable: Training functional models using these tokenizers would be (nearly) impossible.</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a><span class="sd">		- Erroneous: These tokenizers might raise exceptions during use.</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a><span class="sd">		# Development</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a><span class="sd">		`is_invalid` is implemented to always return `True` in some abstract classes where all currently possible subclass instances are valid.</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a><span class="sd">		When adding new subclasses or data members, the developer should check if any such blanket statement of validity still holds and update it as neccesary.</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a><span class="sd">		## Nesting</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a><span class="sd">		In general, when implementing this method, there is no need to recursively call `is_valid` on nested `_TokenizerElement`s contained in the class.</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a><span class="sd">		In other words, failures of `is_valid` need not bubble up to the top of the nested `_TokenizerElement` tree.</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a><span class="sd">		`MazeTokenizerModular.is_valid` calls `is_valid` on each of its `_TokenizerElement`s individually, so failure at any level will be detected.</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a><span class="sd">		## Types of Invalidity</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a><span class="sd">		If it&#39;s judged to be useful, the types of invalidity could be implemented with an Enum or similar rather than only living in comments.</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a><span class="sd">		This could be used to create more or less stringent filters on the valid `_TokenizerElement` instances.</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>		<span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a><span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="n">_TokenizerElement</span><span class="p">)</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a><span class="k">def</span><span class="w"> </span><span class="nf">_unsupported_is_invalid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">do_except</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>  <span class="c1"># noqa: ANN001</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;Default implementation of `is_valid` for `mark_as_unsupported`-decorated classes&quot;&quot;&quot;</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>	<span class="k">if</span> <span class="n">do_except</span><span class="p">:</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>		<span class="n">err_msg</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>			<span class="sa">f</span><span class="s2">&quot;Class `</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="w"> </span><span class="si">= }</span><span class="s2">, marked as unsupported, is not valid.&quot;</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>			<span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="si">= }</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="w"> </span><span class="si">= }</span><span class="s2">&quot;</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>		<span class="p">)</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>		<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>	<span class="k">return</span> <span class="kc">False</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a><span class="c1"># TYPING: better type hints for this function</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a><span class="k">def</span><span class="w"> </span><span class="nf">mark_as_unsupported</span><span class="p">(</span><span class="n">is_valid</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">T</span><span class="p">,</span> <span class="nb">bool</span><span class="p">],</span> <span class="nb">bool</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">T</span><span class="p">],</span> <span class="n">T</span><span class="p">]:</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;mark a _TokenizerElement as unsupported.</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a><span class="sd">	Classes marked with this decorator won&#39;t show up in `get_all_tokenizers()` and thus wont be tested.</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a><span class="sd">	The classes marked in release 1.0.0 did work reliably before being marked, but they can&#39;t be instantiated since the decorator adds an abstract method.</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a><span class="sd">	The decorator exists to prune the space of tokenizers returned by `all_instances` both for testing and usage.</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a><span class="sd">	Previously, the space was too large, resulting in impractical runtimes.</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a><span class="sd">	These decorators could be removed in future releases to expand the space of possible tokenizers.</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">wrapper</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>		<span class="c1"># intentionally modifying method here</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>		<span class="c1"># idk why it things `T`/`self` should not be an argument</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>		<span class="bp">cls</span><span class="o">.</span><span class="n">is_valid</span> <span class="o">=</span> <span class="n">is_valid</span>  <span class="c1"># type: ignore[assignment, method-assign]</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>		<span class="k">return</span> <span class="bp">cls</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>	<span class="k">return</span> <span class="n">wrapper</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a><span class="c1"># TODO: why noqa here? `B024 `__TokenizerElementNamespace` is an abstract base class, but it has no abstract methods or properties`</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a><span class="k">class</span><span class="w"> </span><span class="nc">__TokenizerElementNamespace</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABC</span><span class="p">):</span>  <span class="c1"># noqa: B024</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;ABC for namespaces</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a><span class="sd">	# Properties</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a><span class="sd">	- key: The binding used in `MazeTokenizerModular` for instances of the classes contained within that `__TokenizerElementNamespace`.</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>	<span class="c1"># HACK: this is not the right way of doing this lol</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>	<span class="n">key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="ne">NotImplementedError</span>  <span class="c1"># type: ignore[assignment]</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a><span class="k">def</span><span class="w"> </span><span class="nf">_load_tokenizer_element</span><span class="p">(</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>	<span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>	<span class="n">namespace</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">__TokenizerElementNamespace</span><span class="p">],</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_TokenizerElement</span><span class="p">:</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;Loads a `TokenizerElement` stored via zanj.&quot;&quot;&quot;</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>	<span class="n">key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">namespace</span><span class="o">.</span><span class="n">key</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>	<span class="n">format_</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">_FORMAT_KEY</span><span class="p">]</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>	<span class="n">cls_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">format_</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>	<span class="bp">cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">_TokenizerElement</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>	<span class="n">kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>		<span class="n">k</span><span class="p">:</span> <span class="n">load_item_recursive</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">k</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">())</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>	<span class="p">}</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>	<span class="k">if</span> <span class="n">_FORMAT_KEY</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>		<span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">_FORMAT_KEY</span><span class="p">)</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>	<span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


                <br/>
            </section>
                <section id="mark_as_unsupported">
                            <input id="mark_as_unsupported-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mark_as_unsupported</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">is_valid</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="o">~</span><span class="n">T</span><span class="p">,</span> <span class="nb">bool</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">Callable</span><span class="p">[[</span><span class="o">~</span><span class="n">T</span><span class="p">],</span> <span class="o">~</span><span class="n">T</span><span class="p">]</span>:</span></span>

                <div class="source-button-container">
            <label class="pdoc-button view-source-button" for="mark_as_unsupported-view-source"><span>View Source</span></label>
            <div class="github-button-wrapper">
                <a class="pdoc-button github-link-button" href="https://github.com/understanding-search/maze-dataset/blob/1.3.0maze_dataset/tokenization/modular/element_base.py#L269-L285" target="_blank">
                    <span>View on GitHub</span>
                </a>
            </div>
        </div>

    </div>
    <a class="headerlink" href="#mark_as_unsupported"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="mark_as_unsupported-270"><a href="#mark_as_unsupported-270"><span class="linenos">270</span></a><span class="k">def</span><span class="w"> </span><span class="nf">mark_as_unsupported</span><span class="p">(</span><span class="n">is_valid</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">T</span><span class="p">,</span> <span class="nb">bool</span><span class="p">],</span> <span class="nb">bool</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">T</span><span class="p">],</span> <span class="n">T</span><span class="p">]:</span>
</span><span id="mark_as_unsupported-271"><a href="#mark_as_unsupported-271"><span class="linenos">271</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;mark a _TokenizerElement as unsupported.</span>
</span><span id="mark_as_unsupported-272"><a href="#mark_as_unsupported-272"><span class="linenos">272</span></a>
</span><span id="mark_as_unsupported-273"><a href="#mark_as_unsupported-273"><span class="linenos">273</span></a><span class="sd">	Classes marked with this decorator won&#39;t show up in `get_all_tokenizers()` and thus wont be tested.</span>
</span><span id="mark_as_unsupported-274"><a href="#mark_as_unsupported-274"><span class="linenos">274</span></a><span class="sd">	The classes marked in release 1.0.0 did work reliably before being marked, but they can&#39;t be instantiated since the decorator adds an abstract method.</span>
</span><span id="mark_as_unsupported-275"><a href="#mark_as_unsupported-275"><span class="linenos">275</span></a><span class="sd">	The decorator exists to prune the space of tokenizers returned by `all_instances` both for testing and usage.</span>
</span><span id="mark_as_unsupported-276"><a href="#mark_as_unsupported-276"><span class="linenos">276</span></a><span class="sd">	Previously, the space was too large, resulting in impractical runtimes.</span>
</span><span id="mark_as_unsupported-277"><a href="#mark_as_unsupported-277"><span class="linenos">277</span></a><span class="sd">	These decorators could be removed in future releases to expand the space of possible tokenizers.</span>
</span><span id="mark_as_unsupported-278"><a href="#mark_as_unsupported-278"><span class="linenos">278</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="mark_as_unsupported-279"><a href="#mark_as_unsupported-279"><span class="linenos">279</span></a>
</span><span id="mark_as_unsupported-280"><a href="#mark_as_unsupported-280"><span class="linenos">280</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">wrapper</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
</span><span id="mark_as_unsupported-281"><a href="#mark_as_unsupported-281"><span class="linenos">281</span></a>		<span class="c1"># intentionally modifying method here</span>
</span><span id="mark_as_unsupported-282"><a href="#mark_as_unsupported-282"><span class="linenos">282</span></a>		<span class="c1"># idk why it things `T`/`self` should not be an argument</span>
</span><span id="mark_as_unsupported-283"><a href="#mark_as_unsupported-283"><span class="linenos">283</span></a>		<span class="bp">cls</span><span class="o">.</span><span class="n">is_valid</span> <span class="o">=</span> <span class="n">is_valid</span>  <span class="c1"># type: ignore[assignment, method-assign]</span>
</span><span id="mark_as_unsupported-284"><a href="#mark_as_unsupported-284"><span class="linenos">284</span></a>		<span class="k">return</span> <span class="bp">cls</span>
</span><span id="mark_as_unsupported-285"><a href="#mark_as_unsupported-285"><span class="linenos">285</span></a>
</span><span id="mark_as_unsupported-286"><a href="#mark_as_unsupported-286"><span class="linenos">286</span></a>	<span class="k">return</span> <span class="n">wrapper</span>
</span></pre></div>


            <div class="docstring"><p>mark a _TokenizerElement as unsupported.</p>

<p>Classes marked with this decorator won't show up in <code>get_all_tokenizers()</code> and thus wont be tested.
The classes marked in release 1.0.0 did work reliably before being marked, but they can't be instantiated since the decorator adds an abstract method.
The decorator exists to prune the space of tokenizers returned by <code>all_instances</code> both for testing and usage.
Previously, the space was too large, resulting in impractical runtimes.
These decorators could be removed in future releases to expand the space of possible tokenizers.</p>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>